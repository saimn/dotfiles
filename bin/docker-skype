#!/bin/sh
# From https://registry.hub.docker.com/u/tomparys/skype/ and @yannick1974

set -e

echo ":: Starting docker"
pacmd load-module module-native-protocol-tcp auth-anonymous=1
sudo systemctl start docker.service
cont_pid=`sudo docker run --privileged -d -p 55555:22 -v /dev/video0:/dev/video0:rw -v $HOME/.skype:/home/docker:rw tomparys/skype`
sleep 3s

echo ":: Starting SKype ('ssh docker-skype skype-pulseaudio')"
# ssh docker-skype skype-pulseaudio
docker ps
ssh -X docker-skype skype-pulseaudio && docker kill $cont_pid && docker rm $cont_pid

echo ":: Stopping docker"
pacmd unload-module module-native-protocol-tcp
sudo systemctl stop docker.service
